<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA Test - Instrevi</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #fafafa;
        }
        .status-box {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .status-item:last-child {
            border-bottom: none;
        }
        .status-icon {
            width: 30px;
            height: 30px;
            margin-right: 15px;
            font-size: 24px;
        }
        .pass { color: #4CAF50; }
        .fail { color: #f44336; }
        .warning { color: #ff9800; }
        h1 { color: #333; }
        h2 { color: #666; margin-top: 30px; }
        button {
            background: #9bc97f;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px 10px 0;
        }
        button:hover {
            background: #7ba85c;
        }
        #installBtn {
            display: none;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #2196F3;
        }
    </style>
</head>
<body>
    <h1>PWA Installation Checker</h1>
    
    <div class="info">
        <strong>ðŸ“± Testing Instrevi PWA Features</strong><br>
        This page checks if your app is properly configured as a Progressive Web App.
    </div>

    <div class="status-box">
        <h2>PWA Features Status</h2>
        <div id="statusList"></div>
    </div>

    <div class="status-box">
        <h2>Installation</h2>
        <button id="installBtn">Install Instrevi App</button>
        <p id="installStatus">Checking installation status...</p>
    </div>

    <div class="status-box">
        <h2>Device Information</h2>
        <div id="deviceInfo"></div>
    </div>

    <button onclick="window.location.href='index.html'">Go to Login</button>
    <button onclick="location.reload()">Refresh Check</button>

    <script>
        const checks = [];
        let deferredPrompt;

        // Check Service Worker
        if ('serviceWorker' in navigator) {
            checks.push({ name: 'Service Worker Support', status: 'pass' });
            navigator.serviceWorker.getRegistration().then(reg => {
                if (reg) {
                    addCheck('Service Worker Registered', 'pass');
                } else {
                    addCheck('Service Worker Registered', 'fail', 'Not registered yet');
                }
            });
        } else {
            checks.push({ name: 'Service Worker Support', status: 'fail', msg: 'Not supported' });
        }

        // Check Manifest
        fetch('/manifest.json')
            .then(response => {
                if (response.ok) {
                    addCheck('Manifest File', 'pass');
                    return response.json();
                } else {
                    addCheck('Manifest File', 'fail', 'File not found');
                }
            })
            .then(manifest => {
                if (manifest) {
                    addCheck('Manifest Valid', 'pass', `App name: ${manifest.name}`);
                }
            })
            .catch(() => {
                addCheck('Manifest File', 'fail', 'Could not load');
            });

        // Check if running as installed app
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches 
                          || window.navigator.standalone 
                          || document.referrer.includes('android-app://');
        
        if (isStandalone) {
            addCheck('Running as App', 'pass', 'App is installed and running');
        } else {
            addCheck('Running as App', 'warning', 'Running in browser');
        }

        // Check HTTPS
        if (location.protocol === 'https:' || location.hostname === 'localhost') {
            addCheck('HTTPS/Localhost', 'pass');
        } else {
            addCheck('HTTPS/Localhost', 'fail', 'PWA requires HTTPS');
        }

        // Check for Install Prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installBtn').style.display = 'block';
            document.getElementById('installStatus').textContent = 'âœ“ App can be installed!';
            addCheck('Installable', 'pass', 'Installation available');
        });

        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    document.getElementById('installStatus').textContent = 'âœ“ App installed successfully!';
                } else {
                    document.getElementById('installStatus').textContent = 'Installation cancelled';
                }
                deferredPrompt = null;
                document.getElementById('installBtn').style.display = 'none';
            }
        });

        window.addEventListener('appinstalled', () => {
            document.getElementById('installStatus').textContent = 'âœ“ App has been installed!';
            addCheck('Installation Status', 'pass', 'App is installed');
        });

        // Check if already installed
        if (isStandalone) {
            document.getElementById('installStatus').textContent = 'âœ“ App is already installed and running';
        }

        // Device Information
        const deviceInfo = document.getElementById('deviceInfo');
        deviceInfo.innerHTML = `
            <div class="status-item">
                <strong>User Agent:</strong> ${navigator.userAgent}
            </div>
            <div class="status-item">
                <strong>Platform:</strong> ${navigator.platform}
            </div>
            <div class="status-item">
                <strong>Screen Size:</strong> ${window.screen.width}x${window.screen.height}
            </div>
            <div class="status-item">
                <strong>Viewport:</strong> ${window.innerWidth}x${window.innerHeight}
            </div>
            <div class="status-item">
                <strong>Online Status:</strong> ${navigator.onLine ? 'âœ“ Online' : 'âœ— Offline'}
            </div>
        `;

        function addCheck(name, status, msg = '') {
            checks.push({ name, status, msg });
            updateDisplay();
        }

        function updateDisplay() {
            const list = document.getElementById('statusList');
            list.innerHTML = checks.map(check => {
                const icon = check.status === 'pass' ? 'âœ“' : 
                           check.status === 'fail' ? 'âœ—' : 'âš ';
                const className = check.status;
                return `
                    <div class="status-item">
                        <span class="status-icon ${className}">${icon}</span>
                        <div>
                            <strong>${check.name}</strong>
                            ${check.msg ? `<br><small>${check.msg}</small>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Initial display
        updateDisplay();

        // Timeout check for install prompt
        setTimeout(() => {
            if (!deferredPrompt && !isStandalone) {
                document.getElementById('installStatus').textContent = 
                    'âš  Install prompt not available. Try using Chrome/Edge or check HTTPS.';
                addCheck('Installable', 'warning', 'Install prompt not shown');
            }
        }, 3000);
    </script>
</body>
</html>
